<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>page admin</title>
    <style>

        body {
              margin: 0;
              padding: 0;
              text-align: center;
            }

        .container {
            display: block;
              margin: auto;
              width: 50%;
              heigth: 100%;
        }

        .content-top {
            width: 100%;
            height: 50%;
        }

        .content-bottom {
            width: 100%;
            height: 50%;
            background-color: darkgray;
        }

        .content-top button{
              width: 100px;
              height: 50px;
        }

    </style>

    <script>
       function loadListViewSV(){
           var listViewDiv = document.getElementById("ListViewDiv"); // thêm dòng này
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          listViewDiv.innerHTML = this.responseText;
        }
      };
      xhttp.open("POST", "/listsv", true);
      xhttp.send();
        }

      function loadListViewGV(){
            var listViewDiv = document.getElementById("ListViewDiv"); // thêm dòng này
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          listViewDiv.innerHTML = this.responseText;
        }
      };
      xhttp.open("POST", "/listgv", true);
      xhttp.send();
      }

          // Hàm xóa dòng
            function deleteRow(row) {
              var i = row.parentNode.parentNode.rowIndex;
               var name = document.getElementById("listviewSV").rows[i].cells[0].innerHTML;
              document.getElementById("listviewSV").deleteRow(i);
               console.log(name);
               deleteRecord(name);
            }
                 //dùng để xóa hàm trong cơ sở dữ liệu
                 function deleteRecord(id) {
          var formData = new FormData();
          formData.append("id", id);
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              alert("Bản ghi đã được xóa.");
              location.reload();
            }
          };
          xhttp.open("POST", "/delete-record", true);
          xhttp.send(formData);
        }


          function addNewRow() {
          // Lấy bảng bằng ID
          var table = document.getElementById("listviewSV");

          // Lấy dòng trống để thêm vào
          var emptyRow = document.getElementById("emptyRow");


          // Lấy giá trị bằng các ô input
          var idValue = document.getElementById("inputID").value;
          var magvValue= document.getElementById("inputMaGV").value;
          var tengvValue = document.getElementById("inputTenGV").value

            // Kiểm tra nếu các ô input đều có giá trị
            if (idValue && magvValue && tengvValue) {


                  // Display success message
            var messageDiv = document.getElementById("messageDiv");
            messageDiv.innerHTML = "Thêm thành công!";

            //Xử lý thêm vào mySQL
           // Tạo đối tượng XMLHttpRequest để gửi request lên server
          var xhttp = new XMLHttpRequest();

          // Định nghĩa hàm xử lý khi nhận được response từ server
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              // Xử lý response từ server tại đây
              // Ví dụ: hiển thị thông báo thành công
              document.getElementById("messageDiv").innerHTML = "Thêm sinh viên thành công!";
              // Refresh lại trang sau khi thêm thành công
              window.location.href = "/student-list";
            }
          };

          // Gửi request lên server
          xhttp.open("POST", "/submit-form", true);
          xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
          xhttp.send("id=" + id + "&masv=" + masv + "&tensv=" + tensv);

            //Tạo dòng mới
            var newRow = table.insertRow(emptyRow.rowIndex);

            // Thêm các ô td vào dòng mới
            var idCell = newRow.insertCell(0);
            var magvCell = newRow.insertCell(1);
            var tengvCell = newRow.insertCell(2);
            var editCell = newRow.insertCell(3);
            var deleteCell = newRow.insertCell(4);

              // Gán giá trị vào các ô td
            idCell.innerHTML = idValue;
            magvCell.innerHTML = magvValue;
            tengvCell.innerHTML = tengvValue;
            editCell.innerHTML = "<button >Sửa</button>";
            deleteCell.innerHTML = "<button onclick='deleteRow(this)'>Xóa</button>";

              // Reset giá trị các ô input
            document.getElementById("inputID").value = "";
            document.getElementById("inputMaGV").value = "";
            document.getElementById("inputTenGV").value = "";


             // Di chuyển dòng trống xuống dưới
            table.moveRow(emptyRow.rowIndex, emptyRow.rowIndex + 1);




            } else {
                // Nếu có ô input nào không có giá trị, hiển thị thông báo lỗi
                alert("Vui lòng nhập đầy đủ thông tin!");
            }


        }






    </script>

</head>
<body>
<div class="container">
    <div class="content-top">
        <a href="#" style="float:right;">Xin chào:<p style="display:inline;" th:text="${matk}"></p></a> <br>

        <button type="button" onclick="loadListViewSV()">Danh sách sinh viên</button>
        <button type="button" onclick="loadListViewGV()">Danh sách giáo viên</button>
    </div>

    <div class="content-bottom" id="ListViewDiv">

    </div>
</div>


</body>
</html>